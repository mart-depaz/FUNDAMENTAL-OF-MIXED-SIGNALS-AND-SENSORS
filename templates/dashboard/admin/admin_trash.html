<!-- templates/dashboard/admin_trash.html -->
{% extends 'partials/base.html' %}
{% load static %}
{% block title %}Admin Dashboard - Trash{% endblock %}
{% block navigation %}
<!-- Override default navigation - no top bar for admin -->
{% endblock %}
{% block content %}
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<link rel="stylesheet" href="{% static 'css/mobile_responsive.css' %}">
<style>
    body { 
        font-family: 'Inter', sans-serif; 
        background: linear-gradient(135deg, #DFCFD5 0%, #ffffff 100%);
    }
</style>

<!-- Admin Top Bar -->
{% include 'dashboard/admin/admin_topbar.html' %}

<div class="min-h-screen bg-gray-100 flex flex-col lg:flex-row">
    <!-- Sidebar -->
    {% include 'dashboard/admin/admin_sidebar.html' %}

    <main id="main-content" class="flex-grow p-2 lg:p-3 lg:ml-64 mt-16 overflow-y-auto" style="height: calc(100vh - 64px); overscroll-behavior: contain;">
        <div class="p-2 md:p-3 bg-white lg:bg-gray-50 flex-grow rounded-lg shadow-inner min-h-full">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h1 class="text-lg font-bold text-gray-900 flex items-center">
                        <i class="fas fa-trash-alt w-5 h-5 mr-2" style="color: #3C4770;"></i> Trash
                    </h1>
                    <p class="text-xs text-gray-600 mt-1">Deleted items will be permanently removed after 30 days</p>
                </div>
                {% if deleted_departments or deleted_programs or deleted_users %}
                <div class="flex gap-2">
                    <button onclick="openRestoreAllModal()" class="px-4 py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-sm">
                        <i class="fas fa-undo mr-2"></i> Restore All
                    </button>
                    <button onclick="openDeleteAllModal()" class="px-4 py-2 bg-red-600 text-white text-sm font-semibold rounded-lg hover:bg-red-700 transition duration-150 shadow-sm">
                        <i class="fas fa-trash-alt mr-2"></i> Delete All
                    </button>
                </div>
                {% endif %}
            </div>
            
            <!-- Category Tabs -->
            <div class="flex space-x-2 mb-4 border-b pb-2">
                <button onclick="filterCategory('all')" class="category-tab px-4 py-2 rounded-lg transition duration-150 {% if category == 'all' %}bg-blue-600 text-white{% else %}bg-gray-200 text-gray-700 hover:bg-gray-300{% endif %}" onmouseover="if('{{ category }}' !== 'all') this.style.backgroundColor='#d1d5db';" onmouseout="if('{{ category }}' !== 'all') this.style.backgroundColor='#e5e7eb';">
                    <i class="fas fa-list mr-2"></i> All
                </button>
                <button onclick="filterCategory('departments')" class="category-tab px-4 py-2 rounded-lg transition duration-150 {% if category == 'departments' %}bg-blue-600 text-white{% else %}bg-gray-200 text-gray-700 hover:bg-gray-300{% endif %}" onmouseover="if('{{ category }}' !== 'departments') this.style.backgroundColor='#d1d5db';" onmouseout="if('{{ category }}' !== 'departments') this.style.backgroundColor='#e5e7eb';">
                    <i class="fas fa-building mr-2"></i> Departments ({{ deleted_departments|length }})
                </button>
                <button onclick="filterCategory('programs')" class="category-tab px-4 py-2 rounded-lg transition duration-150 {% if category == 'programs' %}bg-blue-600 text-white{% else %}bg-gray-200 text-gray-700 hover:bg-gray-300{% endif %}" onmouseover="if('{{ category }}' !== 'programs') this.style.backgroundColor='#d1d5db';" onmouseout="if('{{ category }}' !== 'programs') this.style.backgroundColor='#e5e7eb';">
                    <i class="fas fa-graduation-cap mr-2"></i> Programs ({{ deleted_programs|length }})
                </button>
                <button onclick="filterCategory('users')" class="category-tab px-4 py-2 rounded-lg transition duration-150 {% if category == 'users' %}bg-blue-600 text-white{% else %}bg-gray-200 text-gray-700 hover:bg-gray-300{% endif %}" onmouseover="if('{{ category }}' !== 'users') this.style.backgroundColor='#d1d5db';" onmouseout="if('{{ category }}' !== 'users') this.style.backgroundColor='#e5e7eb';">
                    <i class="fas fa-users mr-2"></i> Users ({{ deleted_users|length }})
                </button>
            </div>
            
            <!-- Departments Section -->
            {% if category == 'all' or category == 'departments' %}
            {% if deleted_departments %}
            <div class="mb-6">
                <h2 class="text-base font-bold text-gray-800 mb-3 flex items-center">
                    <i class="fas fa-building mr-2 text-blue-600"></i> Deleted Departments
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for dept in deleted_departments %}
                    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-4">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center space-x-3 flex-1">
                                {% if dept.icon %}
                                <img src="{{ dept.icon.url }}" alt="{{ dept.code }}" class="w-12 h-12 object-contain rounded">
                                {% else %}
                                <div class="w-12 h-12 rounded flex items-center justify-center" style="background-color: #3C4770; color: white;">
                                    <i class="fas fa-building text-lg"></i>
                                </div>
                                {% endif %}
                                <div class="flex-1">
                                    <h3 class="text-sm font-bold text-gray-900">
                                        {% if dept.code %}{{ dept.code }} - {% endif %}{{ dept.name }}
                                    </h3>
                                    <p class="text-xs text-gray-500 mt-1">Deleted: {{ dept.deleted_at|date:"M d, Y" }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between pt-3 border-t border-gray-200">
                            <div class="text-xs text-gray-600">
                                <i class="fas fa-clock mr-1"></i> {{ dept.days_until_deletion }} days left
                            </div>
                            <div class="flex gap-2">
                                <button onclick="openRestoreDepartmentModal({{ dept.id }}, {% if dept.code %}'{{ dept.code|escapejs }}'{% else %}''{% endif %}, '{{ dept.name|escapejs }}')" class="px-3 py-1.5 bg-green-600 text-white text-xs font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-sm">
                                    <i class="fas fa-undo mr-1"></i> Restore
                                </button>
                                <button onclick="openPermanentDeleteDepartmentModal({{ dept.id }}, {% if dept.code %}'{{ dept.code|escapejs }}'{% else %}''{% endif %}, '{{ dept.name|escapejs }}')" class="px-3 py-1.5 bg-red-600 text-white text-xs font-semibold rounded-lg hover:bg-red-700 transition duration-150 shadow-sm">
                                    <i class="fas fa-trash mr-1"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            {% endif %}
            
            <!-- Programs Section -->
            {% if category == 'all' or category == 'programs' %}
            {% if deleted_programs %}
            <div class="mb-6">
                <h2 class="text-base font-bold text-gray-800 mb-3 flex items-center">
                    <i class="fas fa-graduation-cap mr-2 text-blue-600"></i> Deleted Programs
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for prog in deleted_programs %}
                    <div class="bg-white rounded-lg shadow-md border border-gray-200 p-4">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center space-x-3 flex-1">
                                {% if prog.icon %}
                                <img src="{{ prog.icon.url }}" alt="{{ prog.code }}" class="w-12 h-12 object-contain rounded">
                                {% else %}
                                <div class="w-12 h-12 rounded flex items-center justify-center" style="background-color: #3C4770; color: white;">
                                    <i class="fas fa-graduation-cap text-lg"></i>
                                </div>
                                {% endif %}
                                <div class="flex-1">
                                    <h3 class="text-sm font-bold text-gray-900">{{ prog.code }} - {{ prog.name }}</h3>
                                    <p class="text-xs text-gray-500 mt-1">Department: {{ prog.department }}</p>
                                    <p class="text-xs text-gray-500">Deleted: {{ prog.deleted_at|date:"M d, Y" }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between pt-3 border-t border-gray-200">
                            <div class="text-xs text-gray-600">
                                <i class="fas fa-clock mr-1"></i> {{ prog.days_until_deletion }} days left
                            </div>
                            <div class="flex gap-2">
                                <button onclick="openRestoreProgramModal({{ prog.id }}, '{{ prog.code|escapejs }}', '{{ prog.name|escapejs }}', '{{ prog.department|escapejs }}')" class="px-3 py-1.5 bg-green-600 text-white text-xs font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-sm">
                                    <i class="fas fa-undo mr-1"></i> Restore
                                </button>
                                <button onclick="openPermanentDeleteProgramModal({{ prog.id }}, '{{ prog.code|escapejs }}', '{{ prog.name|escapejs }}', '{{ prog.department|escapejs }}')" class="px-3 py-1.5 bg-red-600 text-white text-xs font-semibold rounded-lg hover:bg-red-700 transition duration-150 shadow-sm">
                                    <i class="fas fa-trash mr-1"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            {% endif %}
            
            <!-- Users Section -->
            {% if category == 'all' or category == 'users' %}
            {% if deleted_users %}
            <div class="mb-6">
                <h2 class="text-base font-bold text-gray-800 mb-3 flex items-center">
                    <i class="fas fa-users mr-2 text-blue-600"></i> Deleted Users
                </h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200 text-xs">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Deleted</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Days Left</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for usr in deleted_users %}
                            <tr class="hover:bg-gray-50">
                                <td class="px-3 py-2 whitespace-nowrap">
                                    <div class="text-xs font-semibold text-gray-900">{{ usr.full_name|default:usr.username }}</div>
                                </td>
                                <td class="px-3 py-2 whitespace-nowrap">
                                    <div class="text-xs text-gray-600">{{ usr.email }}</div>
                                </td>
                                <td class="px-3 py-2 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full {% if usr.is_teacher %}bg-blue-100 text-blue-800{% else %}bg-green-100 text-green-800{% endif %}">
                                        {% if usr.is_teacher %}Instructor{% else %}Student{% endif %}
                                    </span>
                                </td>
                                <td class="px-3 py-2 whitespace-nowrap">
                                    <div class="text-xs text-gray-600">{{ usr.deleted_at|date:"M d, Y" }}</div>
                                </td>
                                <td class="px-3 py-2 whitespace-nowrap">
                                    <div class="text-xs text-gray-600">
                                        <i class="fas fa-clock mr-1"></i> {{ usr.days_until_deletion }} days
                                    </div>
                                </td>
                                <td class="px-3 py-2 whitespace-nowrap">
                                    <div class="flex gap-2">
                                        <button onclick="openRestoreUserModal({{ usr.id }}, '{{ usr.full_name|default:usr.username|escapejs }}', '{{ usr.email|escapejs }}', '{% if usr.is_teacher %}Instructor{% else %}Student{% endif %}')" class="px-3 py-1.5 bg-green-600 text-white text-xs font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-sm">
                                            <i class="fas fa-undo mr-1"></i> Restore
                                        </button>
                                        <button onclick="openPermanentDeleteUserModal({{ usr.id }}, '{{ usr.full_name|default:usr.username|escapejs }}', '{{ usr.email|escapejs }}', '{% if usr.is_teacher %}Instructor{% else %}Student{% endif %}')" class="px-3 py-1.5 bg-red-600 text-white text-xs font-semibold rounded-lg hover:bg-red-700 transition duration-150 shadow-sm">
                                            <i class="fas fa-trash mr-1"></i> Delete
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
            {% endif %}
            
            <!-- Empty State -->
            {% if not deleted_departments and not deleted_programs and not deleted_users %}
            <div class="text-center p-12 bg-gray-50 rounded-xl">
                <i class="fas fa-trash-alt text-6xl text-gray-400 mb-4"></i>
                <p class="text-xl text-gray-600 mb-2">Trash is empty</p>
                <p class="text-gray-500">No deleted items found</p>
            </div>
            {% endif %}
        </div>
    </main>
</div>

<!-- Restore Department Modal -->
<div id="restore-department-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm hidden z-[110] flex items-center justify-center p-4 overflow-y-auto">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 md:p-8">
        <div class="flex justify-between items-start mb-6">
            <h3 class="text-2xl font-bold flex items-center text-green-600">
                <i class="fas fa-undo w-6 h-6 mr-2"></i> Restore Department
            </h3>
            <button onclick="closeRestoreDepartmentModal()" class="text-gray-400 hover:text-gray-600 transition duration-150 hover:opacity-75">
                <i class="fas fa-times w-6 h-6"></i>
            </button>
        </div>
        
        <div class="space-y-4">
            <p class="text-gray-700">Are you sure you want to restore this department?</p>
            <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded">
                <p class="font-semibold text-green-800" id="restore-department-name"></p>
            </div>
            <p class="text-sm text-gray-600">The department will be restored and will appear in the Academics section again.</p>
            
            <input type="hidden" id="restore-department-id">
            
            <div class="flex justify-end space-x-3 pt-6 border-t border-gray-100">
                <button onclick="closeRestoreDepartmentModal()" class="px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition duration-150 shadow-sm">
                    Cancel
                </button>
                <button onclick="confirmRestoreDepartment()" class="px-4 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-sm">
                    <i class="fas fa-undo mr-2"></i> Restore Department
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Restore Program Modal -->
<div id="restore-program-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm hidden z-[110] flex items-center justify-center p-4 overflow-y-auto">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 md:p-8">
        <div class="flex justify-between items-start mb-6">
            <h3 class="text-2xl font-bold flex items-center text-green-600">
                <i class="fas fa-undo w-6 h-6 mr-2"></i> Restore Program
            </h3>
            <button onclick="closeRestoreProgramModal()" class="text-gray-400 hover:text-gray-600 transition duration-150 hover:opacity-75">
                <i class="fas fa-times w-6 h-6"></i>
            </button>
        </div>
        
        <div class="space-y-4">
            <p class="text-gray-700">Are you sure you want to restore this program?</p>
            <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded">
                <p class="font-semibold text-green-800" id="restore-program-name"></p>
                <p class="text-sm text-green-700 mt-1" id="restore-program-department"></p>
            </div>
            <p class="text-sm text-gray-600">The program will be restored and will appear in the Academics section again.</p>
            
            <input type="hidden" id="restore-program-id">
            
            <div class="flex justify-end space-x-3 pt-6 border-t border-gray-100">
                <button onclick="closeRestoreProgramModal()" class="px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition duration-150 shadow-sm">
                    Cancel
                </button>
                <button onclick="confirmRestoreProgram()" class="px-4 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-sm">
                    <i class="fas fa-undo mr-2"></i> Restore Program
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Restore User Modal -->
<div id="restore-user-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm hidden z-[110] flex items-center justify-center p-4 overflow-y-auto">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 md:p-8">
        <div class="flex justify-between items-start mb-6">
            <h3 class="text-2xl font-bold flex items-center text-green-600">
                <i class="fas fa-undo w-6 h-6 mr-2"></i> Restore User
            </h3>
            <button onclick="closeRestoreUserModal()" class="text-gray-400 hover:text-gray-600 transition duration-150 hover:opacity-75">
                <i class="fas fa-times w-6 h-6"></i>
            </button>
        </div>
        
        <div class="space-y-4">
            <p class="text-gray-700">Are you sure you want to restore this user?</p>
            <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded">
                <p class="font-semibold text-green-800" id="restore-user-name"></p>
                <p class="text-sm text-green-700 mt-1" id="restore-user-email"></p>
                <p class="text-sm text-green-700" id="restore-user-role"></p>
            </div>
            <p class="text-sm text-gray-600">The user will be restored and will be able to access the system again.</p>
            
            <input type="hidden" id="restore-user-id">
            
            <div class="flex justify-end space-x-3 pt-6 border-t border-gray-100">
                <button onclick="closeRestoreUserModal()" class="px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition duration-150 shadow-sm">
                    Cancel
                </button>
                <button onclick="confirmRestoreUser()" class="px-4 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-sm">
                    <i class="fas fa-undo mr-2"></i> Restore User
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Permanent Delete Department Modal -->
<div id="permanent-delete-department-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm hidden z-[110] flex items-center justify-center p-4 overflow-y-auto">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 md:p-8">
        <div class="flex justify-between items-start mb-6">
            <h3 class="text-2xl font-bold flex items-center text-red-600">
                <i class="fas fa-exclamation-triangle w-6 h-6 mr-2"></i> Permanently Delete Department
            </h3>
            <button onclick="closePermanentDeleteDepartmentModal()" class="text-gray-400 hover:text-gray-600 transition duration-150 hover:opacity-75">
                <i class="fas fa-times w-6 h-6"></i>
            </button>
        </div>
        
        <div class="space-y-4">
            <p class="text-gray-700 font-semibold">Warning: This action cannot be undone!</p>
            <p class="text-gray-700">Are you sure you want to permanently delete this department?</p>
            <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                <p class="font-semibold text-red-800" id="permanent-delete-department-name"></p>
            </div>
            <p class="text-sm text-gray-600">This will permanently remove the department from the system. This action cannot be reversed.</p>
            
            <input type="hidden" id="permanent-delete-department-id">
            
            <div class="flex justify-end space-x-3 pt-6 border-t border-gray-100">
                <button onclick="closePermanentDeleteDepartmentModal()" class="px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition duration-150 shadow-sm">
                    Cancel
                </button>
                <button onclick="confirmPermanentDeleteDepartment()" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150 shadow-sm">
                    <i class="fas fa-trash mr-2"></i> Delete Permanently
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Permanent Delete Program Modal -->
<div id="permanent-delete-program-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm hidden z-[110] flex items-center justify-center p-4 overflow-y-auto">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 md:p-8">
        <div class="flex justify-between items-start mb-6">
            <h3 class="text-2xl font-bold flex items-center text-red-600">
                <i class="fas fa-exclamation-triangle w-6 h-6 mr-2"></i> Permanently Delete Program
            </h3>
            <button onclick="closePermanentDeleteProgramModal()" class="text-gray-400 hover:text-gray-600 transition duration-150 hover:opacity-75">
                <i class="fas fa-times w-6 h-6"></i>
            </button>
        </div>
        
        <div class="space-y-4">
            <p class="text-gray-700 font-semibold">Warning: This action cannot be undone!</p>
            <p class="text-gray-700">Are you sure you want to permanently delete this program?</p>
            <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                <p class="font-semibold text-red-800" id="permanent-delete-program-name"></p>
                <p class="text-sm text-red-700 mt-1" id="permanent-delete-program-department"></p>
            </div>
            <p class="text-sm text-gray-600">This will permanently remove the program from the system. This action cannot be reversed.</p>
            
            <input type="hidden" id="permanent-delete-program-id">
            
            <div class="flex justify-end space-x-3 pt-6 border-t border-gray-100">
                <button onclick="closePermanentDeleteProgramModal()" class="px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition duration-150 shadow-sm">
                    Cancel
                </button>
                <button onclick="confirmPermanentDeleteProgram()" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150 shadow-sm">
                    <i class="fas fa-trash mr-2"></i> Delete Permanently
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Restore All Modal -->
<div id="restore-all-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm hidden z-[110] flex items-center justify-center p-4 overflow-y-auto">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 md:p-8">
        <div class="flex justify-between items-start mb-6">
            <h3 class="text-2xl font-bold flex items-center text-green-600">
                <i class="fas fa-undo w-6 h-6 mr-2"></i> Restore All Items
            </h3>
            <button onclick="closeRestoreAllModal()" class="text-gray-400 hover:text-gray-600 transition duration-150 hover:opacity-75">
                <i class="fas fa-times w-6 h-6"></i>
            </button>
        </div>
        
        <div class="space-y-4">
            <p class="text-gray-700">Are you sure you want to restore all items in trash?</p>
            <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded">
                <p class="font-semibold text-green-800" id="restore-all-count"></p>
            </div>
            <p class="text-sm text-gray-600">All deleted departments, programs, and users will be restored and will appear in their respective sections again.</p>
            
            <div class="flex justify-end space-x-3 pt-6 border-t border-gray-100">
                <button onclick="closeRestoreAllModal()" class="px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition duration-150 shadow-sm">
                    Cancel
                </button>
                <button onclick="confirmRestoreAll()" class="px-4 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-150 shadow-sm">
                    <i class="fas fa-undo mr-2"></i> Restore All
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete All Modal -->
<div id="delete-all-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm hidden z-[110] flex items-center justify-center p-4 overflow-y-auto">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 md:p-8">
        <div class="flex justify-between items-start mb-6">
            <h3 class="text-2xl font-bold flex items-center text-red-600">
                <i class="fas fa-exclamation-triangle w-6 h-6 mr-2"></i> Delete All Items
            </h3>
            <button onclick="closeDeleteAllModal()" class="text-gray-400 hover:text-gray-600 transition duration-150 hover:opacity-75">
                <i class="fas fa-times w-6 h-6"></i>
            </button>
        </div>
        
        <div class="space-y-4">
            <p class="text-gray-700 font-semibold">Warning: This action cannot be undone!</p>
            <p class="text-gray-700">Are you sure you want to permanently delete all items in trash?</p>
            <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                <p class="font-semibold text-red-800" id="delete-all-count"></p>
            </div>
            <p class="text-sm text-gray-600">This will permanently remove all deleted departments, programs, and users from the system. This action cannot be reversed.</p>
            
            <div class="flex justify-end space-x-3 pt-6 border-t border-gray-100">
                <button onclick="closeDeleteAllModal()" class="px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition duration-150 shadow-sm">
                    Cancel
                </button>
                <button onclick="confirmDeleteAll()" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150 shadow-sm">
                    <i class="fas fa-trash mr-2"></i> Delete All Permanently
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Permanent Delete User Modal -->
<div id="permanent-delete-user-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 backdrop-blur-sm hidden z-[110] flex items-center justify-center p-4 overflow-y-auto">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 md:p-8">
        <div class="flex justify-between items-start mb-6">
            <h3 class="text-2xl font-bold flex items-center text-red-600">
                <i class="fas fa-exclamation-triangle w-6 h-6 mr-2"></i> Permanently Delete User
            </h3>
            <button onclick="closePermanentDeleteUserModal()" class="text-gray-400 hover:text-gray-600 transition duration-150 hover:opacity-75">
                <i class="fas fa-times w-6 h-6"></i>
            </button>
        </div>
        
        <div class="space-y-4">
            <p class="text-gray-700 font-semibold">Warning: This action cannot be undone!</p>
            <p class="text-gray-700">Are you sure you want to permanently delete this user?</p>
            <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                <p class="font-semibold text-red-800" id="permanent-delete-user-name"></p>
                <p class="text-sm text-red-700 mt-1" id="permanent-delete-user-email"></p>
                <p class="text-sm text-red-700" id="permanent-delete-user-role"></p>
            </div>
            <p class="text-sm text-gray-600">This will permanently remove the user from the system. This action cannot be reversed.</p>
            
            <input type="hidden" id="permanent-delete-user-id">
            
            <div class="flex justify-end space-x-3 pt-6 border-t border-gray-100">
                <button onclick="closePermanentDeleteUserModal()" class="px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition duration-150 shadow-sm">
                    Cancel
                </button>
                <button onclick="confirmPermanentDeleteUser()" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150 shadow-sm">
                    <i class="fas fa-trash mr-2"></i> Delete Permanently
                </button>
            </div>
        </div>
    </div>
</div>

<script>
function filterCategory(category) {
    window.location.href = '{% url "dashboard:admin_trash" %}?category=' + category;
}

// Restore Department Modal Functions
function openRestoreDepartmentModal(departmentId, code, name) {
    document.getElementById('restore-department-modal').classList.remove('hidden');
    document.getElementById('restore-department-id').value = departmentId;
    document.getElementById('restore-department-name').textContent = (code ? code + ' - ' : '') + name;
}

function closeRestoreDepartmentModal() {
    document.getElementById('restore-department-modal').classList.add('hidden');
}

function confirmRestoreDepartment() {
    const departmentId = document.getElementById('restore-department-id').value;
    
    fetch(`/dashboard/admin-dashboard/departments/${departmentId}/restore/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'Department restored successfully!', 'success');
            } else {
                alert(data.message || 'Department restored successfully!');
            }
            closeRestoreDepartmentModal();
            setTimeout(() => location.reload(), 1000);
        } else {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'Failed to restore department.', 'error');
            } else {
                alert(data.message || 'Failed to restore department.');
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        if (typeof showNotification === 'function') {
            showNotification('An error occurred while restoring the department.', 'error');
        } else {
            alert('An error occurred while restoring the department.');
        }
    });
}

// Restore Program Modal Functions
function openRestoreProgramModal(programId, code, name, department) {
    document.getElementById('restore-program-modal').classList.remove('hidden');
    document.getElementById('restore-program-id').value = programId;
    document.getElementById('restore-program-name').textContent = code + ' - ' + name;
    document.getElementById('restore-program-department').textContent = 'Department: ' + department;
}

function closeRestoreProgramModal() {
    document.getElementById('restore-program-modal').classList.add('hidden');
}

function confirmRestoreProgram() {
    const programId = document.getElementById('restore-program-id').value;
    
    fetch(`/dashboard/admin-dashboard/programs/${programId}/restore/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'Program restored successfully!', 'success');
            } else {
                alert(data.message || 'Program restored successfully!');
            }
            closeRestoreProgramModal();
            setTimeout(() => location.reload(), 1000);
        } else {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'Failed to restore program.', 'error');
            } else {
                alert(data.message || 'Failed to restore program.');
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        if (typeof showNotification === 'function') {
            showNotification('An error occurred while restoring the program.', 'error');
        } else {
            alert('An error occurred while restoring the program.');
        }
    });
}

// Restore User Modal Functions
function openRestoreUserModal(userId, name, email, role) {
    document.getElementById('restore-user-modal').classList.remove('hidden');
    document.getElementById('restore-user-id').value = userId;
    document.getElementById('restore-user-name').textContent = name;
    document.getElementById('restore-user-email').textContent = 'Email: ' + email;
    document.getElementById('restore-user-role').textContent = 'Role: ' + role;
}

function closeRestoreUserModal() {
    document.getElementById('restore-user-modal').classList.add('hidden');
}

function confirmRestoreUser() {
    const userId = document.getElementById('restore-user-id').value;
    
    fetch(`/dashboard/admin-dashboard/users/${userId}/restore/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'User restored successfully!', 'success');
            } else {
                alert(data.message || 'User restored successfully!');
            }
            closeRestoreUserModal();
            setTimeout(() => location.reload(), 1000);
        } else {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'Failed to restore user.', 'error');
            } else {
                alert(data.message || 'Failed to restore user.');
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        if (typeof showNotification === 'function') {
            showNotification('An error occurred while restoring the user.', 'error');
        } else {
            alert('An error occurred while restoring the user.');
        }
    });
}

// Permanent Delete Department Modal Functions
function openPermanentDeleteDepartmentModal(departmentId, code, name) {
    document.getElementById('permanent-delete-department-modal').classList.remove('hidden');
    document.getElementById('permanent-delete-department-id').value = departmentId;
    document.getElementById('permanent-delete-department-name').textContent = (code ? code + ' - ' : '') + name;
}

function closePermanentDeleteDepartmentModal() {
    document.getElementById('permanent-delete-department-modal').classList.add('hidden');
}

function confirmPermanentDeleteDepartment() {
    const departmentId = document.getElementById('permanent-delete-department-id').value;
    
    fetch(`/dashboard/admin-dashboard/departments/${departmentId}/permanent-delete/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'Department permanently deleted!', 'success');
            } else {
                alert(data.message || 'Department permanently deleted!');
            }
            closePermanentDeleteDepartmentModal();
            setTimeout(() => location.reload(), 1000);
        } else {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'Failed to permanently delete department.', 'error');
            } else {
                alert(data.message || 'Failed to permanently delete department.');
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        if (typeof showNotification === 'function') {
            showNotification('An error occurred while permanently deleting the department.', 'error');
        } else {
            alert('An error occurred while permanently deleting the department.');
        }
    });
}

// Permanent Delete Program Modal Functions
function openPermanentDeleteProgramModal(programId, code, name, department) {
    document.getElementById('permanent-delete-program-modal').classList.remove('hidden');
    document.getElementById('permanent-delete-program-id').value = programId;
    document.getElementById('permanent-delete-program-name').textContent = code + ' - ' + name;
    document.getElementById('permanent-delete-program-department').textContent = 'Department: ' + department;
}

function closePermanentDeleteProgramModal() {
    document.getElementById('permanent-delete-program-modal').classList.add('hidden');
}

function confirmPermanentDeleteProgram() {
    const programId = document.getElementById('permanent-delete-program-id').value;
    
    fetch(`/dashboard/admin-dashboard/programs/${programId}/permanent-delete/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'Program permanently deleted!', 'success');
            } else {
                alert(data.message || 'Program permanently deleted!');
            }
            closePermanentDeleteProgramModal();
            setTimeout(() => location.reload(), 1000);
        } else {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'Failed to permanently delete program.', 'error');
            } else {
                alert(data.message || 'Failed to permanently delete program.');
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        if (typeof showNotification === 'function') {
            showNotification('An error occurred while permanently deleting the program.', 'error');
        } else {
            alert('An error occurred while permanently deleting the program.');
        }
    });
}

// Permanent Delete User Modal Functions
function openPermanentDeleteUserModal(userId, name, email, role) {
    document.getElementById('permanent-delete-user-modal').classList.remove('hidden');
    document.getElementById('permanent-delete-user-id').value = userId;
    document.getElementById('permanent-delete-user-name').textContent = name;
    document.getElementById('permanent-delete-user-email').textContent = 'Email: ' + email;
    document.getElementById('permanent-delete-user-role').textContent = 'Role: ' + role;
}

function closePermanentDeleteUserModal() {
    document.getElementById('permanent-delete-user-modal').classList.add('hidden');
}

function confirmPermanentDeleteUser() {
    const userId = document.getElementById('permanent-delete-user-id').value;
    
    fetch(`/dashboard/admin-dashboard/users/${userId}/permanent-delete/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'User permanently deleted!', 'success');
            } else {
                alert(data.message || 'User permanently deleted!');
            }
            closePermanentDeleteUserModal();
            setTimeout(() => location.reload(), 1000);
        } else {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'Failed to permanently delete user.', 'error');
            } else {
                alert(data.message || 'Failed to permanently delete user.');
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        if (typeof showNotification === 'function') {
            showNotification('An error occurred while permanently deleting the user.', 'error');
        } else {
            alert('An error occurred while permanently deleting the user.');
        }
    });
}

// Close modals when clicking outside
document.getElementById('restore-department-modal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closeRestoreDepartmentModal();
    }
});

document.getElementById('restore-program-modal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closeRestoreProgramModal();
    }
});

document.getElementById('restore-user-modal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closeRestoreUserModal();
    }
});

document.getElementById('permanent-delete-department-modal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closePermanentDeleteDepartmentModal();
    }
});

document.getElementById('permanent-delete-program-modal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closePermanentDeleteProgramModal();
    }
});

document.getElementById('permanent-delete-user-modal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closePermanentDeleteUserModal();
    }
});

// Restore All Modal Functions
function openRestoreAllModal() {
    const deptCount = {{ deleted_departments|length }};
    const progCount = {{ deleted_programs|length }};
    const userCount = {{ deleted_users|length }};
    const totalCount = deptCount + progCount + userCount;
    
    let countText = `Total: ${totalCount} item${totalCount !== 1 ? 's' : ''}`;
    if (deptCount > 0) countText += ` (${deptCount} department${deptCount !== 1 ? 's' : ''}`;
    if (progCount > 0) countText += `${deptCount > 0 ? ', ' : ' ('}${progCount} program${progCount !== 1 ? 's' : ''}`;
    if (userCount > 0) countText += `${deptCount > 0 || progCount > 0 ? ', ' : ' ('}${userCount} user${userCount !== 1 ? 's' : ''}`;
    if (deptCount > 0 || progCount > 0 || userCount > 0) countText += ')';
    
    document.getElementById('restore-all-modal').classList.remove('hidden');
    document.getElementById('restore-all-count').textContent = countText;
}

function closeRestoreAllModal() {
    document.getElementById('restore-all-modal').classList.add('hidden');
}

function confirmRestoreAll() {
    fetch('{% url "dashboard:admin_restore_all_trash" %}', {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'All items restored successfully!', 'success');
            } else {
                alert(data.message || 'All items restored successfully!');
            }
            closeRestoreAllModal();
            setTimeout(() => location.reload(), 1000);
        } else {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'Failed to restore all items.', 'error');
            } else {
                alert(data.message || 'Failed to restore all items.');
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        if (typeof showNotification === 'function') {
            showNotification('An error occurred while restoring all items.', 'error');
        } else {
            alert('An error occurred while restoring all items.');
        }
    });
}

document.getElementById('restore-all-modal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closeRestoreAllModal();
    }
});

// Delete All Modal Functions
function openDeleteAllModal() {
    const deptCount = {{ deleted_departments|length }};
    const progCount = {{ deleted_programs|length }};
    const userCount = {{ deleted_users|length }};
    const totalCount = deptCount + progCount + userCount;
    
    let countText = `Total: ${totalCount} item${totalCount !== 1 ? 's' : ''}`;
    if (deptCount > 0) countText += ` (${deptCount} department${deptCount !== 1 ? 's' : ''}`;
    if (progCount > 0) countText += `${deptCount > 0 ? ', ' : ' ('}${progCount} program${progCount !== 1 ? 's' : ''}`;
    if (userCount > 0) countText += `${deptCount > 0 || progCount > 0 ? ', ' : ' ('}${userCount} user${userCount !== 1 ? 's' : ''}`;
    if (deptCount > 0 || progCount > 0 || userCount > 0) countText += ')';
    
    document.getElementById('delete-all-modal').classList.remove('hidden');
    document.getElementById('delete-all-count').textContent = countText;
}

function closeDeleteAllModal() {
    document.getElementById('delete-all-modal').classList.add('hidden');
}

function confirmDeleteAll() {
    fetch('{% url "dashboard:admin_delete_all_trash" %}', {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'All items permanently deleted!', 'success');
            } else {
                alert(data.message || 'All items permanently deleted!');
            }
            closeDeleteAllModal();
            setTimeout(() => location.reload(), 1000);
        } else {
            if (typeof showNotification === 'function') {
                showNotification(data.message || 'Failed to delete all items.', 'error');
            } else {
                alert(data.message || 'Failed to delete all items.');
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        if (typeof showNotification === 'function') {
            showNotification('An error occurred while deleting all items.', 'error');
        } else {
            alert('An error occurred while deleting all items.');
        }
    });
}

document.getElementById('delete-all-modal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closeDeleteAllModal();
    }
});
</script>

{% endblock %}

