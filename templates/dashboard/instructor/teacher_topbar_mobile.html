<!-- templates/dashboard/instructor/teacher_topbar_mobile.html - Mobile-Responsive Topbar for Instructor Dashboard -->
{% load static %}
<style>
    .topbar-brand { text-decoration: none; }
    .topbar-brand:hover .topbar-brand-text { text-decoration: underline; }
    
    /* Mobile hamburger menu toggle */
    .mobile-sidebar-toggle {
        display: none;
    }
    
    @media (max-width: 1024px) {
        .mobile-sidebar-toggle {
            display: inline-flex !important;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            color: white;
            font-size: 20px;
            margin-right: 0.5rem;
        }
        
        .mobile-sidebar-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    }
    
    /* Enhanced mobile responsive styles */
    @media (max-width: 768px) {
        .topbar-brand-text {
            display: none;
        }
        
        .center-school-name {
            display: none;
        }
        
        header#teacher-top-bar .max-w-full {
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }
        
        .topbar-spacing {
            gap: 0.5rem;
        }
    }
    
    @media (max-width: 640px) {
        .topbar-brand span:first-child {
            width: 40px !important;
            height: 40px !important;
        }
        
        .topbar-brand img {
            width: 36px !important;
            height: 36px !important;
        }
        
        .user-name-mobile {
            display: none;
        }
    }
    
    /* Ensure proper touch targets on mobile */
    @media (max-width: 768px) {
        button[onclick*="toggle"] {
            min-width: 44px;
            min-height: 44px;
        }
    }
</style>
<header id="teacher-top-bar" class="fixed top-0 left-0 right-0 z-50 w-full shadow-md" style="background: linear-gradient(90deg, #3C4770 0%, #447294 100%); box-shadow: 0 2px 10px rgba(60, 71, 112, 0.3);">
    <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
            <!-- Mobile sidebar toggle button -->
            <button class="mobile-sidebar-toggle lg:hidden" onclick="toggleSidebar()" title="Toggle Menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <!-- Left Section: Attendance System Branding -->
            <div class="flex items-center flex-shrink-0">
                <a href="{% url 'dashboard:teacher_dashboard' %}" class="topbar-brand text-lg sm:text-xl md:text-2xl font-bold text-white select-none flex items-center hover:opacity-90 transition duration-150 cursor-pointer space-x-2 md:space-x-3">
                    <span class="inline-flex items-center justify-center h-9 w-9 sm:h-10 sm:w-10 md:h-11 md:w-11 rounded-full bg-white/10 border border-white/30 shadow-md overflow-hidden flex-shrink-0">
                        <img src="{% static 'img/attendance-logo.png' %}" alt="Attendance System logo" class="h-7 w-7 sm:h-8 sm:w-8 md:h-10 md:w-10 object-contain">
                    </span>
                    <span class="topbar-brand-text hidden sm:inline">Attendance System</span>
                </a>
            </div>
            
            <!-- Center Section: School Name with Profile Picture on Left (Hidden on Mobile) -->
            {% if school_admin and school_admin.school_name %}
            <div class="flex-1 hidden md:flex justify-center items-center space-x-2 px-4">
                {% if school_admin.profile_picture %}
                <img id="topbar-center-profile-picture" src="{{ school_admin.profile_picture.url }}?v={{ school_admin.id }}" alt="Profile" class="h-6 w-6 rounded-full object-cover border-2 border-white flex-shrink-0">
                {% else %}
                <div id="topbar-center-profile-placeholder" class="h-6 w-6 rounded-full flex items-center justify-center text-white font-bold text-xs flex-shrink-0" style="background: rgba(190, 129, 153, 0.3);">
                    {{ school_admin.username|first|upper|default:"A" }}
                </div>
                {% endif %}
                <span class="text-sm text-white font-medium truncate max-w-sm center-school-name">
                    {{ school_admin.school_name }}
                </span>
            </div>
            {% elif user.school_name %}
            <div class="flex-1 hidden md:flex justify-center items-center space-x-2 px-4">
                <span class="text-sm text-white font-medium truncate max-w-sm center-school-name">
                    {{ user.school_name }}
                </span>
            </div>
            {% else %}
            <div class="flex-1 hidden md:block"></div>
            {% endif %}

            <!-- Right Section: Action Icons -->
            <div class="flex items-center topbar-spacing space-x-1 sm:space-x-2 md:space-x-3 flex-shrink-0">
                <!-- Notifications Button with Dropdown -->
                <div class="relative">
                    <button type="button" onclick="toggleNotificationsDropdown()" class="relative p-1.5 md:p-2 text-white hover:bg-white/20 transition duration-150 rounded-full cursor-pointer flex items-center justify-center" title="Notifications">
                        <i class="fas fa-bell w-4 h-4 md:w-5 md:h-5"></i>
                        <!-- Notification badge - always present, shown/hidden by JavaScript -->
                        <span class="notification-badge-dot absolute top-0 right-0 block h-2 w-2 rounded-full ring-2 ring-white bg-red-500" style="display: {% if unread_notifications|default:0 > 0 %}block{% else %}none{% endif %};"></span>
                        <span class="notification-badge-count absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold rounded-full min-w-[20px] h-5 px-1 flex items-center justify-center" style="display: {% if unread_notifications|default:0 > 0 %}flex{% else %}none{% endif %};">
                            {% if unread_notifications|default:0 > 9 %}9+{% else %}{{ unread_notifications|default:0 }}{% endif %}
                        </span>
                    </button>
                    
                    <!-- Notifications Dropdown (Cloud/Speech Bubble Style) -->
                    <div id="notificationsDropdown" class="hidden absolute right-0 mt-2 w-72 sm:w-80 md:w-96 bg-white rounded-xl shadow-2xl border border-gray-200 z-50" style="max-height: 500px;">
                        <!-- Arrow pointing up -->
                        <div class="absolute -top-2 right-6 w-4 h-4 bg-white border-l border-t border-gray-200 transform rotate-45"></div>
                        
                        <!-- Header -->
                        <div class="flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-xl">
                            <h3 class="text-lg font-bold text-gray-900 flex items-center">
                                <i class="fas fa-bell w-5 h-5 mr-2" style="color: #3C4770;"></i> Notifications
                            </h3>
                            <button onclick="closeNotificationsDropdown()" class="text-gray-400 hover:text-gray-600 transition">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <!-- Notifications Content -->
                        <div id="notificationsContent" class="overflow-y-auto p-4 space-y-3" style="max-height: 400px;">
                            <!-- Notifications will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- User Profile Avatar/Dropdown -->
                <div class="relative">
                    <button onclick="toggleProfileDropdown()" class="flex items-center justify-center space-x-2 p-1 md:p-1.5 bg-white/20 rounded-full transition duration-150 hover:bg-white/30 hover:shadow-md" title="User Profile">
                        <span class="text-white text-xs md:text-sm font-medium hidden sm:inline user-name-mobile">{{ user.full_name|default:user.username }}</span>
                        {% if user.profile_picture %}
                        <img id="topbar-profile-picture" src="{{ user.profile_picture.url }}?v={{ user.id }}" alt="Profile" class="h-7 w-7 md:h-8 md:w-8 rounded-full object-cover border-2 border-white flex-shrink-0">
                        {% else %}
                        <div id="topbar-profile-placeholder" class="h-7 w-7 md:h-8 md:w-8 rounded-full flex items-center justify-center text-white font-bold text-xs md:text-sm flex-shrink-0" style="background: rgba(190, 129, 153, 0.3);">
                            {{ user.full_name|first|upper|default:"T" }}
                        </div>
                        {% endif %}
                        <i class="fas fa-chevron-down text-white text-xs hidden md:inline-flex flex-shrink-0"></i>
                    </button>
                    
                    <!-- Dropdown Menu -->
                    <div id="profile-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-1 z-50 border border-gray-200">
                        <a href="#" id="profile-dropdown-link" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center transition-colors">
                            <i class="fas fa-user mr-2 w-4"></i> Profile
                        </a>
                        <a href="{% url 'logout' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center transition-colors">
                            <i class="fas fa-sign-out-alt mr-2 w-4"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<script>
function toggleProfileDropdown() {
    const dropdown = document.getElementById('profile-dropdown');
    if (dropdown) {
        dropdown.classList.toggle('hidden');
    }
}

// Handle profile link click - opens modal when clicking "Profile" in dropdown
document.addEventListener('DOMContentLoaded', function() {
    const profileLink = document.getElementById('profile-dropdown-link');
    if (profileLink) {
        profileLink.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            // Close dropdown
            const dropdown = document.getElementById('profile-dropdown');
            if (dropdown) {
                dropdown.classList.add('hidden');
            }
            
            // Open profile modal
            setTimeout(function() {
                if (typeof window.openProfileModal === 'function') {
                    window.openProfileModal();
                    return;
                }
                if (typeof openProfileModal === 'function') {
                    openProfileModal();
                    return;
                }
                const modal = document.getElementById('profile-modal');
                if (modal) {
                    modal.classList.remove('hidden');
                    if (typeof window.cancelProfileEdit === 'function') {
                        window.cancelProfileEdit();
                    } else if (typeof cancelProfileEdit === 'function') {
                        cancelProfileEdit();
                    }
                }
            }, 100);
        });
    }
});

// Close dropdown when clicking outside
document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('profile-dropdown');
    if (!dropdown) return;
    
    const button = event.target.closest('button[onclick="toggleProfileDropdown()"]');
    const dropdownElement = event.target.closest('#profile-dropdown');
    const profileLink = event.target.closest('#profile-dropdown-link');
    
    if (profileLink) {
        return;
    }
    
    if (button) {
        return;
    }
    
    if (dropdownElement) {
        return;
    }
    
    dropdown.classList.add('hidden');
});

function toggleNotificationsDropdown() {
    const dropdown = document.getElementById('notificationsDropdown');
    if (dropdown) {
        dropdown.classList.toggle('hidden');
    }
}

function closeNotificationsDropdown() {
    const dropdown = document.getElementById('notificationsDropdown');
    if (dropdown) {
        dropdown.classList.add('hidden');
    }
}

// Close notifications dropdown when clicking outside
document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('notificationsDropdown');
    if (!dropdown) return;
    
    const button = event.target.closest('button[onclick="toggleNotificationsDropdown()"]');
    const dropdownElement = event.target.closest('#notificationsDropdown');
    
    if (button || dropdownElement) {
        return;
    }
    
    dropdown.classList.add('hidden');
});
</script>
