<!-- templates/dashboard/instructor/teacher_sidebar_mobile.html - Mobile-Responsive Sidebar for Instructor Dashboard -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<style>
    .cropper-container {
        max-width: 100%;
        max-height: 500px;
        min-height: 300px;
        position: relative;
        background-color: transparent;
    }
    
    /* Ensure crop box is visible - overlay only outside crop area */
    .cropper-container .cropper-crop-box {
        border: 2px solid #3b82f6 !important;
        box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5) !important;
        background-color: transparent !important;
    }
    
    /* Make sure the image area doesn't have grey background */
    .cropper-container .cropper-canvas {
        background-color: transparent !important;
    }
    
    .cropper-container .cropper-view-box {
        outline: 1px solid rgba(59, 130, 246, 0.5) !important;
        background-color: transparent !important;
    }
    
    /* Background overlay for the entire cropper container (outside the image) */
    .cropper-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #f3f4f6;
        z-index: -1;
    }
    
    /* Make all crop box handles more visible */
    .cropper-container .cropper-crop-box .cropper-point {
        width: 10px !important;
        height: 10px !important;
        background-color: #3b82f6 !important;
        border: 2px solid #ffffff !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
    }
    
    .cropper-container .cropper-crop-box .cropper-point:hover {
        background-color: #2563eb !important;
        transform: scale(1.15);
        transition: all 0.2s;
    }
    
    /* Remove underlines from all sidebar links and buttons */
    .sidebar-link,
    .sidebar-link:hover,
    .sidebar-link:focus,
    .sidebar-link:active,
    .sidebar-link:visited {
        text-decoration: none !important;
    }
    
    .sidebar-link span,
    .sidebar-link .font-medium {
        text-decoration: none !important;
    }
    
    #sidebar a,
    #sidebar a:hover,
    #sidebar a:focus,
    #sidebar a:active,
    #sidebar a:visited {
        text-decoration: none !important;
    }
    
    #sidebar button,
    #sidebar button:hover,
    #sidebar button:focus,
    #sidebar button:active {
        text-decoration: none !important;
    }

    /* Enforce uniform sidebar link structure and spacing so all sections match Manage Courses */
    #sidebar-nav .sidebar-link {
        display: flex !important;
        align-items: center !important;
        gap: 0.75rem !important;
        padding-left: 1rem !important;
        padding-right: 1rem !important;
        padding-top: 0.625rem !important; /* 10px */
        padding-bottom: 0.625rem !important;
        min-height: 44px !important;
        box-sizing: border-box !important;
    }
    /* Icon sizing & spacing: enforce consistent icon width and right margin so text aligns like Manage Courses */
    #sidebar-nav .sidebar-link i,
    #sidebar-nav .sidebar-link img {
        width: 20px !important;
        min-width: 20px !important;
        text-align: center !important;
        flex-shrink: 0 !important;
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        margin-right: 0.75rem !important; /* consistent spacing between icon and text */
        font-size: 1rem !important;
        line-height: 1 !important;
    }
    #sidebar-nav .sidebar-link .font-medium,
    #sidebar-nav .sidebar-link span {
        flex: 1 1 auto !important;
        min-width: 0 !important;
        overflow: hidden !important;
        white-space: nowrap !important;
        text-overflow: ellipsis !important;
    }
    /* Ensure section labels don't shift content */
    #sidebar-nav p { margin: 0 0 0.5rem 0 !important; padding-left: 0.75rem !important; }
    
    /* Mobile sidebar improvements */
    @media (max-width: 768px) {
        #sidebar {
            width: 70vw !important;
            max-width: 280px !important;
            padding: 1rem !important;
        }
        
        .sidebar-menu-item {
            padding: 0.75rem 0.5rem !important;
            font-size: 0.9rem !important;
        }
        
        .sidebar-menu-item i {
            font-size: 1rem !important;
            width: 20px !important;
        }
        
        .sidebar-section-label {
            font-size: 0.75rem !important;
            padding: 0.5rem !important;
        }
        
        /* Improve touch targets */
        #sidebar button,
        #sidebar a {
            padding: 0.75rem !important;
            min-height: 44px;
        }
    }
    
    @media (max-width: 640px) {
        #sidebar {
            width: 80vw !important;
            max-width: 240px !important;
            padding: 0.75rem !important;
        }
    }

    /* Tighten layout for very small screens to match admin exactly */
    @media (max-width: 600px) {
        #sidebar { width: 80vw !important; max-width: 240px !important; padding: 0.5rem 0.5rem 0.75rem 0.5rem !important; }
        #sidebar .flex.items-center.justify-between { margin-bottom: 0.5rem !important; padding-bottom: 0.5rem !important; }
        /* Force nav layout to flex column with zero spacing */
        #sidebar-nav { padding: 0 !important; margin: 0 !important; display: flex !important; flex-direction: column !important; gap: 0 !important; }
        /* Hide section div margins to prevent shifting */
        #sidebar-nav > div { margin: 0 !important; margin-bottom: 0 !important; padding: 0 !important; }
        /* Section labels (p tags) - fix sizing and prevent shift */
        #sidebar-nav p { margin: 0 0 0.3rem 0 !important; padding: 0 0.75rem !important; font-size: 0.65rem !important; height: 14px !important; line-height: 14px !important; }
        /* Sidebar links: perfect uniform alignment regardless of page */
        #sidebar-nav .sidebar-link {
            display: flex !important;
            align-items: center !important;
            justify-content: flex-start !important;
            width: 100% !important;
            height: 40px !important;
            padding: 0.5rem 0.75rem !important;
            margin: 0 !important;
            margin-bottom: 0.2rem !important;
            border: none !important;
            border-radius: 0.5rem !important;
            box-sizing: border-box !important;
            background: transparent !important;
            color: #ffffff !important;
            font-size: 0.9rem !important;
            font-weight: 500 !important;
            transition: all 0.15s ease !important;
        }
        /* Icon/image: 18px fixed, consistent spacing */
        #sidebar-nav .sidebar-link i,
        #sidebar-nav .sidebar-link img {
            width: 18px !important;
            min-width: 18px !important;
            height: 18px !important;
            min-height: 18px !important;
            margin-right: 0.8rem !important;
            margin-left: 0 !important;
            padding: 0 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            flex-shrink: 0 !important;
            font-size: 1rem !important;
            line-height: 1 !important;
        }
        /* Text content: fill remaining space and truncate */
        #sidebar-nav .sidebar-link .font-medium,
        #sidebar-nav .sidebar-link span {
            flex: 1 1 auto !important;
            min-width: 0 !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            white-space: nowrap !important;
            font-size: 0.9rem !important;
            line-height: 1 !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        /* Active/selected state */
        #sidebar-nav .sidebar-link.active,
        #sidebar-nav .sidebar-link[aria-current="page"] {
            background-color: #BE8199 !important;
            color: #3C4770 !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15) !important;
        }
        #sidebar-nav .sidebar-link.active i,
        #sidebar-nav .sidebar-link.active img,
        #sidebar-nav .sidebar-link[aria-current="page"] i,
        #sidebar-nav .sidebar-link[aria-current="page"] img {
            color: #3C4770 !important;
        }
        /* Hover state */
        #sidebar-nav .sidebar-link:not(.active):hover {
            background-color: rgba(255, 255, 255, 0.1) !important;
        }
    }
    
    /* Smooth sidebar toggle animation */
    #sidebar {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    #sidebar.open {
        transform: translateX(0);
    }
    
    #sidebar-overlay {
        transition: opacity 0.3s ease;
    }
</style>

<!-- Mobile Overlay -->
<div id="sidebar-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-40 lg:hidden hidden" onclick="toggleSidebar()"></div>

<!-- Sidebar Content -->
<aside id="sidebar" class="fixed inset-y-0 left-0 transform -translate-x-full lg:translate-x-0 lg:fixed lg:w-64 w-64 text-white p-6 shadow-2xl transition-transform duration-300 ease-in-out z-40 flex flex-col relative overflow-hidden overflow-y-auto" style="background: linear-gradient(180deg, #3C4770 0%, #447294 100%); box-shadow: 2px 0 10px rgba(60, 71, 112, 0.3); top: var(--teacher-header-offset, 64px); height: calc(100vh - var(--teacher-header-offset, 64px)); -webkit-overflow-scrolling: touch;">
    <!-- Header - Fixed at top -->
    <div class="flex items-center justify-between mb-8 pb-4 border-b flex-shrink-0" style="border-color: rgba(190, 129, 153, 0.3);">
        <div class="flex items-center">
            <i class="fas fa-chalkboard-teacher text-2xl mr-2" style="color: #BE8199;"></i>
            <h2 class="text-xl md:text-2xl font-bold tracking-wider">Instructor</h2>
        </div>
        <button class="lg:hidden p-1 rounded-full hover:bg-white/20 flex items-center justify-center min-h-10 min-w-10" onclick="toggleSidebar()">
            <i class="fas fa-times text-lg md:text-xl"></i>
        </button>
    </div>

    <!-- Menu Items Container - Scrollable -->
    <nav id="sidebar-nav" class="space-y-3 flex-1 overflow-y-auto min-h-0" style="scrollbar-width: thin; scrollbar-color: #BE8199 #3C4770; overscroll-behavior: contain;">
        <!-- Dashboard Section -->
        <div class="mb-4">
            <p class="text-xs font-bold text-white/60 uppercase tracking-wider px-3 mb-2">Dashboard</p>
            <a href="{% url 'dashboard:teacher_dashboard' %}" class="sidebar-link flex items-center w-full px-4 py-3 rounded-xl transition duration-150 hover:bg-white/10 text-white" style="text-decoration: none;">
                <i class="fas fa-home w-5 h-5 mr-3 flex-shrink-0"></i>
                <span class="font-medium text-left flex-grow">Dashboard</span>
            </a>
        </div>

        <!-- Attendance Section -->
        <div class="mb-4">
            <p class="text-xs font-bold text-white/60 uppercase tracking-wider px-3 mb-2">Attendance</p>
            <a href="{% url 'dashboard:students' %}" class="sidebar-link flex items-center w-full px-4 py-3 rounded-xl transition duration-150 hover:bg-white/10 text-white" style="text-decoration: none;">
                <i class="fas fa-user-graduate w-5 h-5 mr-3 flex-shrink-0"></i>
                <span class="font-medium text-left flex-grow">Students</span>
            </a>
            <a href="{% url 'dashboard:instructor_courses' %}" class="sidebar-link flex items-center w-full px-4 py-3 rounded-xl transition duration-150 hover:bg-white/10 text-white" style="text-decoration: none;">
                <i class="fas fa-book w-5 h-5 mr-3 flex-shrink-0"></i>
                <span class="font-medium text-left flex-grow">Courses</span>
            </a>
        </div>

        <!-- Reports Section -->
        <div class="mb-4">
            <p class="text-xs font-bold text-white/60 uppercase tracking-wider px-3 mb-2">Reports</p>
            <a href="{% url 'dashboard:instructor_attendance_reports' %}" class="sidebar-link flex items-center w-full px-4 py-3 rounded-xl transition duration-150 hover:bg-white/10 text-white" style="text-decoration: none;">
                <i class="fas fa-chart-bar w-5 h-5 mr-3 flex-shrink-0"></i>
                <span class="font-medium text-left flex-grow">Attendance Reports</span>
            </a>
        </div>

        <!-- Schedule Section -->
        <div class="mb-4">
            <p class="text-xs font-bold text-white/60 uppercase tracking-wider px-3 mb-2">Schedule</p>
            <a href="{% url 'dashboard:weekly_timetable' %}" class="sidebar-link flex items-center w-full px-4 py-3 rounded-xl transition duration-150 hover:bg-white/10 text-white" style="text-decoration: none;">
                <i class="fas fa-calendar-alt w-5 h-5 mr-3 flex-shrink-0"></i>
                <span class="font-medium text-left flex-grow">Weekly Timetable</span>
            </a>
        </div>
    </nav>

    <!-- Footer Section - Fixed at bottom -->
    <div class="pt-4 mt-6 border-t flex-shrink-0" style="border-color: rgba(190, 129, 153, 0.3);">
        <button onclick="openProfileModal()" class="w-full flex items-center mb-4 hover:bg-white/10 rounded-xl p-2 transition cursor-pointer group" style="color: #ffffff;">
            {% if user.profile_picture %}
            <img id="sidebar-profile-picture" src="{{ user.profile_picture.url }}?v={{ user.id }}" alt="Profile" class="w-10 h-10 rounded-full object-cover border-2 border-white flex-shrink-0">
            {% else %}
            <div id="sidebar-profile-placeholder" class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg border-2 border-white text-white flex-shrink-0" style="background: rgba(190, 129, 153, 0.3);">
                {{ user.full_name|first|upper|default:"T" }}
            </div>
            {% endif %}
            <div class="ml-3 flex-1 min-w-0 text-left">
                <div class="text-sm font-semibold text-white truncate">{{ user.full_name|default:"Instructor" }}</div>
                <div class="text-xs truncate" style="color: rgba(255, 255, 255, 0.8);">ID: {{ user.school_id|default:"N/A" }}</div>
                {% if user.school_name %}
                <div class="text-xs truncate" style="color: rgba(190, 129, 153, 0.9);">{{ user.school_name }}</div>
                {% endif %}
            </div>
        </button>
        <a href="{% url 'logout' %}" class="flex items-center w-full px-4 py-3 rounded-xl transition duration-150 shadow-md hover:bg-white/20" style="color: rgba(255, 255, 255, 0.9); background: rgba(190, 129, 153, 0.2);">
            <i class="fas fa-sign-out-alt w-5 h-5 mr-3"></i>
            <span class="font-medium">Logout</span>
        </a>
    </div>
</aside>

<!-- Note: sidebar behavior (toggle, overlay, link-close, resize) is handled by static/js/instructor_mobile.js -->

<script>
// Instructor sidebar: maintain active state & auto-close on mobile navigation
document.addEventListener('DOMContentLoaded', function() {
    const sidebarLinks = document.querySelectorAll('#sidebar-nav .sidebar-link');

    function applyActive(link) {
        // Use class-based active state to allow CSS to control visuals
        link.classList.add('active');
        link.classList.add('shadow-lg');
        link.setAttribute('aria-current', 'page');
    }
    function removeActive(link) {
        link.classList.remove('active');
        link.classList.remove('shadow-lg');
        link.removeAttribute('aria-current');
    }

    // Simple pathname-based active detection
    const path = window.location.pathname;
    sidebarLinks.forEach(link => {
        const href = link.getAttribute('href') || '';
        // match by last segment or containing path
        if (href && (path === href || path.includes(href) || href.includes(path) || path.includes(link.href))) {
            applyActive(link);
        } else {
            removeActive(link);
        }

        // Auto-close sidebar on mobile when navigating
        link.addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (sidebar && sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
            }
            if (overlay) {
                overlay.classList.add('hidden');
                overlay.style.display = 'none';
            }
            // mark clicked link active for immediate visual feedback
            sidebarLinks.forEach(l => removeActive(l));
            applyActive(this);
        });
    });
});
</script>
