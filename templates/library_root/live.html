<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Live Check</title>
  <style>body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:24px} .box{padding:16px;border:1px solid #ddd;border-radius:6px;max-width:720px}</style>
</head>
<body>
  <div class="box">
    <h2>Service Live Check</h2>
    <p><strong>URL to share:</strong></p>
    <input id="shareUrl" type="text" value="{{ full_url }}" style="width:100%" readonly />
    <p>Copy the URL above and paste it on another device. Open <code>/live/</code> after the host if needed.</p>

    <h3>Camera Test</h3>
    <p>Click <em>Start Camera</em> to test whether the browser can access the camera (requires HTTPS or localhost).</p>
    <button id="start">Start Camera</button>
    <button id="stop">Stop Camera</button>
    <div id="videoWrap" style="margin-top:12px"></div>

    <h3>Health JSON</h3>
    <p>Health endpoint: <code>/health/</code></p>
    <pre id="healthResult">(click check health)</pre>
    <button id="check">Check Health</button>
  </div>

<script>
let stream;
const startBtn = document.getElementById('start');
const stopBtn = document.getElementById('stop');
startBtn.addEventListener('click', async ()=>{
  try{
    stream = await navigator.mediaDevices.getUserMedia({video:true});
    const video = document.createElement('video');
    video.autoplay = true;
    video.playsInline = true;
    video.srcObject = stream;
    video.style.maxWidth = '100%';
    const wrap = document.getElementById('videoWrap');
    wrap.innerHTML = '';
    wrap.appendChild(video);
  }catch(e){
    alert('Camera error: '+e.message);
  }
});
stopBtn.addEventListener('click', ()=>{
  if(stream){
    stream.getTracks().forEach(t=>t.stop());
    document.getElementById('videoWrap').innerHTML='';
  }
});

document.getElementById('check').addEventListener('click', async ()=>{
  try{
    const res = await fetch('/health/');
    const j = await res.json();
    document.getElementById('healthResult').textContent = JSON.stringify(j, null, 2);
  }catch(e){
    document.getElementById('healthResult').textContent = 'Error: '+e.message;
  }
});
</script>
</body>
</html>
